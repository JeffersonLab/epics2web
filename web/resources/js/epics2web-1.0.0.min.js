var jlab=jlab||{};jlab.epics2web=jlab.epics2web||{},function(){function n(n,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var t=document.createEvent("CustomEvent");return t.initCustomEvent(n,e.bubbles,e.cancelable,e.detail),t}return"function"==typeof window.CustomEvent?!1:(n.prototype=window.Event.prototype,void(window.CustomEvent=n))}(),jlab.epics2web.ClientConnection=function(n){var e={url:"ws://"+window.location.host+"/epics2web/monitor",autoOpen:!0,autoReconnect:!0,autoLivenessPingAndTimeout:!0,autoDisplayClasses:!0,pingIntervalMillis:8e3,livenessTimoutMillis:2e3,reconnectWaitMillis:1e4};n||(n={});for(var t in e)"undefined"!=typeof n[t]?this[t]=n[t]:this[t]=e[t];var o=null,i=document.createElement("div"),s=null,c=this,a=null,l=!1,r=function(){null!==o&&o.readyState===WebSocket.OPEN&&(c.ping(),null!==a||(a=setTimeout(function(){o.readyState===WebSocket.OPEN&&o.close(),a=null},c.livenessTimoutMillis)))};i.addEventListener("open",function(n){c.onopen(n)}),i.addEventListener("close",function(n){c.onclose(n)}),i.addEventListener("connecting",function(n){c.onconnecting(n)}),i.addEventListener("closing",function(n){c.onclosing(n)}),i.addEventListener("error",function(n){c.onerror(n)}),i.addEventListener("message",function(n){c.onmessage(n)}),i.addEventListener("info",function(n){c.oninfo(n)}),i.addEventListener("update",function(n){c.onupdate(n)}),i.addEventListener("pong",function(n){c.onpong(n)}),this.addEventListener=i.addEventListener.bind(i),this.removeEventListener=i.removeEventListener.bind(i),this.dispatchEvent=i.dispatchEvent.bind(i),this.open=function(){if(null!==o&&o.readyState!==WebSocket.CLOSED)return console.log("already connected"),1;var n=new CustomEvent("connecting");i.dispatchEvent(n),o=new WebSocket(this.url),o.onerror=function(n){console.log("server connection error");var n=new CustomEvent("error");i.dispatchEvent(n)},o.onclose=function(n){console.log("server connection closed");var n=new CustomEvent("close");i.dispatchEvent(n),null!==a&&(clearTimeout(a),a=null);var e=null===o||o.readyState===WebSocket.CLOSED;c.autoReconnect&&!l&&e&&(l=!0,setTimeout(function(){c.open(),l=!1},c.reconnectWaitMillis))},o.onmessage=function(n){null!==a&&(clearTimeout(a),a=null),s=new Date;var e=JSON.parse(n.data);if(e.date=s,"update"===e.type){var n=new CustomEvent("update",{detail:e});i.dispatchEvent(n)}else if("info"===e.type){var n=new CustomEvent("info",{detail:e});i.dispatchEvent(n)}else if("pong"===e.type){var n=new CustomEvent("pong");i.dispatchEvent(n)}var n=new CustomEvent("message");i.dispatchEvent(n,{detail:e})},o.onopen=function(n){s=new Date;var n=new CustomEvent("open");i.dispatchEvent(n)}},this.close=function(n,e){console.log("close"),null!==o&&o.readyState!==WebSocket.CLOSED?("undefined"==typeof n&&(n=1e3),o.close(n,e)):console.log("already closed")},this.monitorPvs=function(n){var e={type:"monitor",pvs:n};o.send(JSON.stringify(e))},this.clearPvs=function(n){var e={type:"clear",pvs:n};o.send(JSON.stringify(e))},this.ping=function(){var n={type:"ping"};o.send(JSON.stringify(n))},this.autoDisplayClasses===!0&&(i.addEventListener("connecting",function(n){$(".ws-disconnected").hide(),$(".ws-connected").hide(),$(".ws-connecting").show()}),i.addEventListener("open",function(n){$(".ws-disconnected").hide(),$(".ws-connected").show(),$(".ws-connecting").hide()}),i.addEventListener("close",function(n){$(".ws-disconnected").show(),$(".ws-connected").hide(),$(".ws-connecting").hide()})),this.autoOpen===!0&&this.open(),this.autoLivenessPingAndTimeout===!0&&window.setInterval(r,this.pingIntervalMillis)},jlab.epics2web.ClientConnection.prototype.onopen=function(){},jlab.epics2web.ClientConnection.prototype.onclose=function(){},jlab.epics2web.ClientConnection.prototype.onconnecting=function(){},jlab.epics2web.ClientConnection.prototype.onclosing=function(){},jlab.epics2web.ClientConnection.prototype.onmessage=function(){},jlab.epics2web.ClientConnection.prototype.onerror=function(){},jlab.epics2web.ClientConnection.prototype.onupdate=function(){},jlab.epics2web.ClientConnection.prototype.oninfo=function(){},jlab.epics2web.ClientConnection.prototype.onpong=function(){},jlab.epics2web.isNumericEpicsType=function(n){var e;switch(n){case"DBR_DOUBLE":case"DBR_FLOAT":case"DBR_INT":case"DBR_SHORT":case"DBR_BYTE":e=!0;break;default:e=!1}return e};