var jlab=jlab||{};jlab.epics2web=jlab.epics2web||{},function(){function e(e,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),t}return"function"==typeof window.CustomEvent?!1:(e.prototype=window.Event.prototype,void(window.CustomEvent=e))}(),jlab.epics2web.ClientConnection=function(e){var n={url:"ws://"+window.location.host+"/epics2web/monitor",autoOpen:!0,autoReconnect:!0,autoLivenessPingAndTimeout:!0,autoDisplayClasses:!0,pingIntervalMillis:8e3,livenessTimoutMillis:2e3,reconnectWaitMillis:1e4,chunkedRequestPvsCount:400};e||(e={});for(var t in n)"undefined"!=typeof e[t]?this[t]=e[t]:this[t]=n[t];var o=null,i=document.createElement("div"),s=null,c=this,a=null,l=!1,u=function(){null!==o&&o.readyState===WebSocket.OPEN&&(c.ping(),null!==a||(a=setTimeout(function(){o.readyState===WebSocket.OPEN&&o.close(),a=null},c.livenessTimoutMillis)))};i.addEventListener("open",function(e){c.onopen(e)}),i.addEventListener("close",function(e){c.onclose(e)}),i.addEventListener("connecting",function(e){c.onconnecting(e)}),i.addEventListener("closing",function(e){c.onclosing(e)}),i.addEventListener("error",function(e){c.onerror(e)}),i.addEventListener("message",function(e){c.onmessage(e)}),i.addEventListener("info",function(e){c.oninfo(e)}),i.addEventListener("update",function(e){c.onupdate(e)}),i.addEventListener("pong",function(e){c.onpong(e)}),this.addEventListener=i.addEventListener.bind(i),this.removeEventListener=i.removeEventListener.bind(i),this.dispatchEvent=i.dispatchEvent.bind(i),this.open=function(){if(null!==o&&o.readyState!==WebSocket.CLOSED)return console.log("already connected"),1;var e=new CustomEvent("connecting");i.dispatchEvent(e),o=new WebSocket(this.url),o.onerror=function(e){console.log("server connection error"),console.log(e);var e=new CustomEvent("error");i.dispatchEvent(e)},o.onclose=function(e){console.log("server connection closed"),console.log(e.reason);var e=new CustomEvent("close");i.dispatchEvent(e),null!==a&&(clearTimeout(a),a=null);var n=null===o||o.readyState===WebSocket.CLOSED;c.autoReconnect&&!l&&n&&(l=!0,setTimeout(function(){c.open(),l=!1},c.reconnectWaitMillis))},o.onmessage=function(e){null!==a&&(clearTimeout(a),a=null),s=new Date;var n=JSON.parse(e.data);if(n.date=s,"update"===n.type){var e=new CustomEvent("update",{detail:n});i.dispatchEvent(e)}else if("info"===n.type){var e=new CustomEvent("info",{detail:n});i.dispatchEvent(e)}else if("pong"===n.type){var e=new CustomEvent("pong");i.dispatchEvent(e)}var e=new CustomEvent("message");i.dispatchEvent(e,{detail:n})},o.onopen=function(e){s=new Date;var e=new CustomEvent("open");i.dispatchEvent(e)}},this.close=function(e,n){console.log("close"),null!==o&&o.readyState!==WebSocket.CLOSED?("undefined"==typeof e&&(e=1e3),o.close(e,n)):console.log("already closed")},this.monitorPvs=function(e){if(c.chunkedRequestPvsCount>0){var n,t,o;for(n=0,t=e.length;t>n;n+=c.chunkedRequestPvsCount)o=e.slice(n,n+c.chunkedRequestPvsCount),this.monitorPvsChunk(o)}else this.monitorPvsChunk(e)},this.monitorPvsChunk=function(e){var n={type:"monitor",pvs:e};o.send(JSON.stringify(n))},this.clearPvs=function(e){if(c.chunkedRequestPvsCount>0){var n,t,o;for(n=0,t=e.length;t>n;n+=c.chunkedRequestPvsCount)o=e.slice(n,n+c.chunkedRequestPvsCount),this.clearPvsChunk(o)}else this.clearPvsChunk(e)},this.clearPvsChunk=function(e){var n={type:"clear",pvs:e};o.send(JSON.stringify(n))},this.ping=function(){var e={type:"ping"};o.send(JSON.stringify(e))},this.autoDisplayClasses===!0&&(i.addEventListener("connecting",function(e){$(".ws-disconnected").hide(),$(".ws-connected").hide(),$(".ws-connecting").show()}),i.addEventListener("open",function(e){$(".ws-disconnected").hide(),$(".ws-connected").show(),$(".ws-connecting").hide()}),i.addEventListener("close",function(e){$(".ws-disconnected").show(),$(".ws-connected").hide(),$(".ws-connecting").hide()})),this.autoOpen===!0&&this.open(),this.autoLivenessPingAndTimeout===!0&&window.setInterval(u,this.pingIntervalMillis)},jlab.epics2web.ClientConnection.prototype.onopen=function(){},jlab.epics2web.ClientConnection.prototype.onclose=function(){},jlab.epics2web.ClientConnection.prototype.onconnecting=function(){},jlab.epics2web.ClientConnection.prototype.onclosing=function(){},jlab.epics2web.ClientConnection.prototype.onmessage=function(){},jlab.epics2web.ClientConnection.prototype.onerror=function(){},jlab.epics2web.ClientConnection.prototype.onupdate=function(){},jlab.epics2web.ClientConnection.prototype.oninfo=function(){},jlab.epics2web.ClientConnection.prototype.onpong=function(){},jlab.epics2web.isNumericEpicsType=function(e){var n;switch(e){case"DBR_DOUBLE":case"DBR_FLOAT":case"DBR_INT":case"DBR_SHORT":case"DBR_BYTE":n=!0;break;default:n=!1}return n};